<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- Site CSS -->
<link href="style/style.css" rel="stylesheet">
<link href="style/style_index.css" rel="stylesheet">
<style type="text/css">
</style>
</head>
<body>
<div id="main">
    <div id="1001" class="push">
        <div class="introduce">
            <span class="user">飞雪连天</span><span class="action">赞同该答案</span>
            <img class="photo" src="test.jpg" />
        </div>
        <div class="title">为什么网页不能居中？</div>
        <div class="answer">
            <div class="a_count">3</div>
            <div class="a_text">1好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上</div>
		</div>
        <div class="line"></div>
    </div>
    
    <div id="1002" class="push">
        <div class="introduce">
            <a class="user" href="#">飞雪连天22</a><span class="action">关注该问题</span>
            <img class="photo" src="test.jpg" />
        </div>
        <div class="title">为什么网页能居中,如果标题很长很长出现两行怎么能够保证包含所有标题呢!!</div>
        <div class="line"></div>
    </div>
    
    <div id="1003" class="push">
        <div class="introduce">
            <a class="user" href="#">飞雪连天22</a><span class="action">关注该问题</span>
            <img class="photo" src="test.jpg" />
        </div>
        <div class="title">为什么网页能居中,如果标题很长很长出现两行怎么能够保证包含所有标题呢!!</div>
        <div class="answer">
            <div class="a_count">3</div>
            <div class="a_text">1好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上</div>
		</div>
        <div class="line"></div>
    </div>
    
    <div id="1003" class="push">
        <div class="introduce">
            <a class="user" href="#">飞雪连天22</a><span class="action">关注该问题</span>
            <img class="photo" src="test.jpg" />
        </div>
        <div class="title">为什么网页能居中,如果标题很长很长出现两行怎么能够保证包含所有标题呢!!</div>
        <div class="answer">
            <div class="a_count">3</div>
            <div class="a_text">1好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上</div>
		</div>
        <div class="line"></div>
    </div>
    
    <div id="1003" class="push">
        <div class="introduce">
            <a class="user" href="#">飞雪连天22</a><span class="action">关注该问题</span>
            <img class="photo" src="test.jpg" />
        </div>
        <div class="title">为什么网页能居中,如果标题很长很长出现两行怎么能够保证包含所有标题呢!!</div>
        <div class="answer">
            <div class="a_count">3</div>
            <div class="a_text">1好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上</div>
		</div>
        <div class="line"></div>
    </div>
    
    <div id="1003" class="push">
        <div class="introduce">
            <a class="user" href="#">飞雪连天22</a><span class="action">关注该问题</span>
            <img class="photo" src="test.jpg" />
        </div>
        <div class="title">为什么网页能居中,如果标题很长很长出现两行怎么能够保证包含所有标题呢!!</div>
        <div class="answer">
            <div class="a_count">3</div>
            <div class="a_text">1好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上</div>
		</div>
        <div class="line"></div>
    </div>
    
    <div id="1003" class="push">
        <div class="introduce">
            <a class="user" href="#">飞雪连天22</a><span class="action">关注该问题</span>
            <img class="photo" src="test.jpg" />
        </div>
        <div class="title">为什么网页能居中,如果标题很长很长出现两行怎么能够保证包含所有标题呢!!</div>
        <div class="answer">
            <div class="a_count">3</div>
            <div class="a_text">1好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上</div>
		</div>
        <div class="line"></div>
    </div>
    
    <div id="1003" class="push">
        <div class="introduce">
            <a class="user" href="#">飞雪连天22</a><span class="action">关注该问题</span>
            <img class="photo" src="test.jpg" />
        </div>
        <div class="title">为什么网页能居中,如果标题很长很长出现两行怎么能够保证包含所有标题呢!!</div>
        <div class="answer">
            <div class="a_count">3</div>
            <div class="a_text">1好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上好好好学习天天向上</div>
		</div>
        <div class="line"></div>
    </div>
</div>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript">
function sendToAndroid(str) {
  window.AndroidFun.getFromWebView(str);
}

function getFromAndroid(obj) {
  window.main_json=eval('('+obj+')');
  $("#title").html(window.main_json.title);
}

function initGlobalVal(ip) {
	IP_ADDR = ip;
}

function initRow(json_row) {
    //生成各项div
    var all_div = $('<div id="'+json_row.id+'" class="push"></div>');
    var introduce_div = $('<div class="introduce"></div>');
    var user_a = $('<a class="user" href="#">'+json_row.user.name+'</a>');
    var action_str;
    switch(parseInt(json_row.action)) {
        case 0:
            action_str = "赞同该回答";
            break;
        case 1:
            action_str = "关注了该问题";
            break;
        case 2:
            action_str = "提出了该问题";
            break;
        case 3:
            action_str = "回答了该问题";
            break;
        default:
            break;
    }
    var action_span = $('<span class="action">'+action_str+'</span>');
    var photo_img = $('<img class="photo" src="'+json_row.user.photo+'" />')
    var title_div = $('<div class="title">'+json_row.title+'</div>');
    if (parseInt(json_row.action) == 0) {
        var answer_div = $('<div class="answer"></div>');
        var count_div = $('<div class="a_count">'+json_row.answer.agree_count+'</div>');
        var text_div = $('<div class="a_text">'+json_row.answer.content+'</div>');
        answer_div.append(count_div);
        answer_div.append(text_div);
    }
    var line_div = $('<div class="line"></div>');
    //拼装整理
    introduce_div.append(user_a);
    introduce_div.append(action_span);
    introduce_div.append(photo_img);
    
    all_div.append(introduce_div);
    all_div.append(title_div);
    if(typeof(answer_div) != "undefined")
        all_div.append(answer_div);
    all_div.append(line_div);
    
    return all_div;
}

function getQues(json) {
	//for (var i = 0; i < json.length; i ++) {
	/*for(var i in json){
		alert(i);
		var title = json[i].title;
		var content = json[i].content;
		alert(title);
		alert(content);
	}*/
		var title = json.title;
		var content = json.content;
		alert(title);
		alert(content);
}

function refresh(tag) { //刷新页面，将从服务端获得最新/更多内容
	var cont = "test";
	$.ajax({
		url:'http://'+IP_ADDR+'/service/index_service.php',
		type:'post',
		dataType:'json',
		data:cont,
		success:function(data){
			var json = eval(data);
			if (tag == "more") {
                addMore(json);
            } else {
                addNew(json);
            }
		},
		error:function(XMLHttpRequest, textStatus, errorThrown){
			alert(errorThrown);
        }
	});
}

function getNew() {//获取最新，将在顶部
	refresh("new");
}

function addNew(json) {//将获取到的内容从顶部加入
    var new_row;
    for(var i = 0; i < json.length; i++) {
        new_row = initRow(json[i]);
        $("#main").prepend(new_row);//加到顶部
    }
}

function getMore() {//获取更多，将在底部加入
	refresh("more");
}

function addMore(json) {//将获取到的内容从底部加入
    var new_row;
    for(var i = 0; i < json.length; i++) {
        new_row = initRow(json[i]);
        $("#main").append(new_row);//加到底部
    }
}

$(document).ready(function(){
    /********测试区域*********/
    /*alert("wati");
	var str = '{"id":"10032", "title":"111222title", "user":"yushi", "action":"0", "answer":{"count":"3", "text":"这是个好问题啊！"}}';
    var json = eval('(' + str + ')');
    alert(json);
    alert(json.title);
    addRow(json);*/
    /********end 测试区域*********/
    
    /*$(".title").click(function(){
      var click_id = $(this).closest(".answer").attr("id");
      var click_title = $(this).text();
      var click_obj = '{"action":"1", "id":"'+click_id+'", "title":"'+click_title+'"}';
      sendToAndroid(click_obj);
    });*/
    /*initGlobalVal();
    $(document).scroll( function() { //判断拉到底部时的动作
        if($(document).scrollTop() + $(window).height() >= $(document).height()){//判断到底，可能需要增加一定缓冲范围刷新
            getMore();//获取更多
        }
    } );*/
});
</script>
</body>
</html>